# Telegram Chat Members Extractor Bot

Бот для извлечения участников из истории чатов Telegram.

## Описание

Этот бот позволяет пользователям загружать файлы истории чатов Telegram и извлекать информацию об участниках, включая:
- Пользователей, которые писали сообщения
- Пользователей, упомянутых в сообщениях
- Информацию о профилях (Telegram ID, username, полное имя, тип аккаунта)

## Особенности

- Обработка файлов истории чатов в форматах JSON, HTML и ZIP
- Извлечение уникальных участников (без дублей и удаленных аккаунтов)
- Поддержка загрузки до 10 файлов одновременно
- Формирование результата в зависимости от количества участников:
  - Менее 51 участника: список в чате
  - 51 и более участников: Excel-файл с вкладками (Участники, Упоминания, Каналы)
- Нет хранения пользовательских данных на сервере (обработка "на лету")
- Поддержка UTF-8 кодировки
- Автоматическое определение наличия каналов в профилях

## Требования

- Python 3.8+
- Docker (для запуска через Docker Compose)
- Telegram Bot Token

## Установка и запуск

### Локальный запуск

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/tg_info_chat_bot.git
cd tg_info_chat_bot
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` с вашим Telegram Bot Token:
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

4. Запустите бота:
```bash
python main.py
```

### Запуск через Docker

1. Создайте файл `.env` с вашим Telegram Bot Token:
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

2. Запустите контейнер:
```bash
docker-compose up -d
```

## Использование

1. Начните чат с ботом в Telegram (команда `/start`)
2. Экспортируйте историю чата в Telegram (Настройки → Экспорт истории чата)
3. Загрузите файлы истории чата в бота (до 10 файлов за раз)
   - Поддерживаются форматы: JSON, HTML, ZIP
4. Отправьте команду `/process` для обработки файлов
5. Бот обработает файлы и вернет:
   - Список участников в чате (если менее 51 участника)
   - Excel-файл с вкладками (если 51 и более участников):
     - **Участники** - пользователи, которые писали сообщения
     - **Упоминания** - пользователи, упомянутые в сообщениях
     - **Каналы** - пользователи с каналами в профиле

### Команды бота

- `/start` - начать работу с ботом
- `/help` - показать инструкцию по использованию
- `/process` - обработать загруженные файлы

## Структура данных в Excel экспорте

Excel файл содержит следующие поля для каждого пользователя:

1. **Telegram ID** - уникальный идентификатор пользователя в Telegram
2. **Username** - имя пользователя с @ (например, @john_doe), если доступно
3. **Имя** - полное имя пользователя (имя и фамилия)
4. **Бот** - является ли пользователь ботом (Да/Нет)

**Примечания:**
- **Username** доступен только для пользователей, которые установили публичное имя в Telegram
- В **HTML экспорте** username недоступен (технические ограничения Telegram)
- В **JSON экспорте** username извлекается из данных сообщений, если пользователь его установил
- Дубликаты пользователей автоматически удаляются по Telegram ID
- Если поле не заполнено, ячейка будет пустой

## Ограничения

- Максимальное количество файлов за одну загрузку: 10
- Максимальный размер файла: 50MB
- Поддерживаемые форматы: JSON, HTML, ZIP (экспорт из Telegram)
- Файлы обрабатываются "на лету" и не сохраняются на сервере
- Удаленные аккаунты не учитываются в результатах
- Дубли пользователей автоматически удаляются по Telegram ID
- **Username** доступен только в JSON экспорте и только для пользователей с публичным именем
- HTML экспорт не содержит username (ограничение формата Telegram)

## Структура проекта

```
tg_bot_info_chat/
├── main.py                  # Основной файл запуска бота
├── bot/                     # Модули бота
│   ├── __init__.py
│   └── handlers.py          # Обработчики команд и сообщений
├── parsers/                 # Парсеры файлов истории
│   ├── __init__.py
│   ├── json_parser.py       # Парсер JSON файлов
│   ├── html_parser.py       # Парсер HTML файлов
│   └── base_parser.py       # Базовый парсер
├── processors/              # Обработка данных
│   ├── __init__.py
│   ├── user_processor.py    # Обработка пользовательских данных
│   └── export_processor.py  # Формирование результата
├── models/                  # Модели данных
│   ├── __init__.py
│   └── user.py              # Модель пользователя
├── config.py                # Конфигурация
├── requirements.txt         # Зависимости
├── Dockerfile               # Docker конфигурация
├── docker-compose.yml       # Docker Compose конфигурация
├── .env.example             # Пример файла с переменными окружения
├── .gitignore               # Игнорируемые файлы Git
└── README.md                # Документация
```

## Архитектура

Бот построен по модульной архитектуре:

1. **bot/handlers.py** - обработчики команд и сообщений Telegram Bot API
2. **parsers/** - парсеры для извлечения данных из файлов экспорта (JSON, HTML)
3. **processors/** - обработка и объединение данных пользователей, формирование экспорта
4. **models/** - модели данных для представления пользователей Telegram

### Процесс работы:

1. Пользователь загружает файлы → файлы сохраняются во временную директорию
2. Команда `/process` → файлы обрабатываются парсерами
3. Извлечение данных → объединение уникальных пользователей
4. Формирование результата → текст или Excel в зависимости от количества
5. Отправка результата → удаление временных файлов

## Технические ограничения

- **Размер файла**: максимум 50MB
- **Количество файлов**: максимум 10 файлов за одну загрузку
- **Форматы**: JSON, HTML, ZIP (экспорт из Telegram)
- **Кодировка**: UTF-8
- **Хранение данных**: файлы не сохраняются на сервере, удаляются сразу после обработки

## Лицензия

MIT